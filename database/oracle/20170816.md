# 备份的操作
## 数据文件
### backup
- datafile 1;
- tablespace users,exaple;
- database;全数据库备份

### list 查看备份
- backup;
- list backup of tablespace users;

### v$backup_set;

### select from dba_data_files;
###控制文件的自动备份

## 增量备份
- 0级别
  - 备份所有的数据
  - 在此级别上可以做1级别的增量备份
- 1级别
  - 累积的 1c
    - 仅包含小于1的增量备份。
  - 差异的 1d
    - 仅包含小于等于1的增量备份，最近一个。找上一次的增量备份。
- 有了归档日志，再做增量备份，可以提高备份恢复的效率。
- 场景：1w个数据块，热点数据100个数据块，会被频繁修改。
  - 备份方式1：全备份+归档日志。
  - 备份方式2：0级增量+1级增量。
- 增量备份的缺点，单独的增量备份是没有作用的。需要在0级增量备份的基础上。
- 全备份之间做增量备份。
- 目标：备份的时间长一些，恢复的时间短一些。
- 如何选择0 、1c、1d？
  - 如果0备周期较长，中间穿插1d，有风险，且恢复成本较高，可穿插1c
  - 1/3 2/3 1/4 经验值 间隔穿插1c备份
- 适合的环境：数据库很大，频繁修改的数据块比较小。
### 操作
- 0备
- 1备
  - 默认1d

### 分两个阶段
  - 读数据块，那些修改了？选出修改的
  - 写入备份
### 增量备份花费的时间并不是很小
### 改进-块跟踪-记录数据块的变化 BCT
- 日志记录被改动的数据块
- 代价：额外开销
- 需要衡量，经常增量备份，需要开启块变化跟踪

## 全备份
- 数据文件中没有数据的数据块不会被备份


## 增量备份没有办法完全回避0级别备份
- 间隔密集，备份成本高
- 间隔大，恢复成本高

## 增量更新=11g的新特性，不是关系数据库的标准功能
- 直接改变所有备份的策略，代价低
### 思想
  - 镜像拷贝，及时同步数据库的变化，直接拿来就用
  - 恢复：和数据文件的差异很小，恢复时不需要很大的操作，
  - 备份：从此不需要0级别的备份，备份的开销小
  - 场景：每晚1d备份，差异不超过一天，
  - 让增量更新与数据文件保持安全距离，稍微远点的距离，

## 操作
- 系统强制创建0级别
- 设置标签
- 可用来恢复的镜像
- 
