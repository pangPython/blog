## 逻辑恢复工具 闪回
- 一组功能
- 解决用户误操作
- 物理结构没有被破坏，被改动，恢复逻辑结构

### 闪回查询 flashback query
- sys用户名下不允许闪回
- 读一致性 多版本并发
- 指定过去一个时间点，利用撤销表空间，构造一个过去某个时刻的状态
- scn--任意时刻，用户的操作，都会和scn进行绑定
- 涉及时间的操作尽量使用scn
- scn 3秒内是一样的，精度不够
- select * from t1 as of scn ****;
- select * from t1 as of timestemp to_timestemp('','');;
- 如何获取一个精准的时间点、scn?
  - 挖掘日志  重做日志：不记录过程只记录结果，块的变更
    - dbms_logmnr
- dbms_logmnr_d
- mysql记录日志
  - blog-binary log-sql语句
    - 局限：sysdata
  - inno db
    - 针对块的变化
- alter table move;
- 闪回版本查询
  - 查询一段时间
    - versions between scn1 and scn2；
- 短时间之内的使用闪回版本查询

## 闪回表
- 替代不完全恢复的
### 把多张表一起闪回
- row movemoent 行应用的功能
- 表闪回时索引自动更新

## flashback drop
- 利用回收站机制
  - 回收站占用的空间是临时向系统借用的，如果空闲空间不足，系统会覆盖回收站的数据
- 没有使用撤销数据
- 要删除的对象改名，原地不动
- 先使用真正空闲的空间，再将回收站的空间清空，收回，之后，是否自动扩展，
- 还原索引时，系统保留索引的名字为回收站的名称
### 重名
  - 回收站中重名
    - 恢复时，还原时间最近的一个表
  - 回收站和数据库的对象有重名
    - 不允许还原
    - 还原的同时改名字

## 闪回事务查询
- 把一个事物撤销，表里边其他的事务不受影响
- 不会真正撤销，给出语句，让用户自己检查数据库一致性 UNDO_SQL

## 闪回数据归档
- 交易系统，记录用户对数据所有的变更，版本查询保存在撤销表空间，不是永久保留
- 利用版本信息，把撤销数据放在普通的用户表空间中，长时间保留历史数据
- 限制：一旦开启fda，这个表结构就不允许改变了，
- 不是所有数据库通用的，Oracle特有的，不利于开发一套通用的系统

## 闪回数据库
- 把整个数据库闪回到过去某个时间点
- 开启闪回之后，数据库可以回退
- 与不完全恢复的区别
  - 代价不同：不完全恢复，先退一大步，在执行日志前进到时间点，闪回，直接回退数据库
  - 让不完全恢复的地位进一步下降
- 与datagold等组件配合，可以展示更好的
